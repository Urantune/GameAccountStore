    <!DOCTYPE html>
    <html lang="en" xmlns:th="http://www.thymeleaf.org"
          xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="utf-8">
        <title>Pending Orders</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <link th:href="@{/lib/animate/animate.min.css}" rel="stylesheet">
        <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">

        <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
        <link th:href="@{/css/style.css}" rel="stylesheet">

        <style>
            body{ background:#f5f7fa; font-family:"Open Sans",sans-serif; }
            .game-nav{ background:pink; border-top:2px solid #e6d8c8; height:86px; display:flex; align-items:center; }
            .game-nav .container-fluid{ display:flex; align-items:center; }
            .nav-logo{ height:180px; width:auto; }
            .nav-center{ gap:26px; }
            .game-nav .navbar-nav .nav-link{ color:#111!important; font-weight:500; }
            .nav-pill{ background:transparent; color:#000!important; border:1px solid transparent; transition:background .15s ease, box-shadow .15s ease, transform .15s ease; border-radius:18px!important; padding:10px 18px!important; }
            .nav-pill:hover{ color:#f7931e!important; background:#F8F8FF; box-shadow:0 6px 18px rgba(0,0,0,.08)!important; transform:none!important; }
            .nav-pill:focus,.nav-pill:active{ background:#f5e6d7!important; color:#000!important; box-shadow:0 6px 18px rgba(0,0,0,.08)!important; }
            .dropdown-soft{ border-radius:14px; padding:6px; }
            .page-header{ background:#2a3f54; color:#fff; padding:26px 0; }
            .card-soft{ border:0; border-radius:16px; box-shadow:0 8px 22px rgba(0,0,0,.06); }
            .mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
            .badge-soft{ border-radius:999px; padding:.5rem .8rem; }
            .auto-hide-alert{ max-width:820px; margin-left:auto; margin-right:auto; font-weight:500; }
            .table thead th{ white-space:nowrap; }
            .group-title{ font-weight:800; letter-spacing:.2px; }
            .pill{ display:inline-flex; align-items:center; gap:8px; padding:7px 12px; border-radius:999px; background:#fff; border:1px solid #eee; }
            .order-card{ border:1px solid #eee; border-radius:16px; padding:14px 14px 6px; background:#fff; }
            .order-header{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; padding:6px 6px 12px; border-bottom:1px dashed #eee; margin-bottom:12px; }
            .order-left{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
            .order-right{ display:flex; align-items:center; gap:14px; flex-wrap:wrap; }
            .order-meta{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
            .meta-chip{ display:inline-flex; align-items:center; gap:8px; padding:7px 12px; border-radius:999px; border:1px solid #eee; background:#fff; }
            .meta-chip .label{ color:#666; font-size:12px; }
            .meta-chip .val{ font-weight:700; }
            .btn-cancel{ display:inline-flex; align-items:center; gap:8px; }
        </style>
    </head>

    <body>

    <nav class="navbar navbar-expand-lg game-nav shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/home">
                <img src="/img/logoFinal.png" alt="Logo" class="nav-logo">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="mainNavbar">
                <ul class="navbar-nav mx-auto align-items-center nav-center">
                    <li class="nav-item">
                        <a class="nav-link nav-pill" href="/home">
                            <i class="fa fa-home me-2"></i>Trang Chủ
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link nav-pill dropdown-toggle require-login"
                           href="#"
                           data-bs-toggle="dropdown"
                           th:data-logged="${#authorization.expression('isAuthenticated()')}">
                            <i class="fa fa-list me-2"></i>Tài khoaản vĩnh viễn
                        </a>
                        <ul class="dropdown-menu dropdown-soft">
                            <li>
                                <a class="dropdown-item require-login"
                                   th:href="@{/home/listAcc(game='AOV')}"
                                   th:data-logged="${#authorization.expression('isAuthenticated()')}">
                                    AOV
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item require-login"
                                   th:href="@{/home/listAcc(game='FREE FIRE')}"
                                   th:data-logged="${#authorization.expression('isAuthenticated()')}">
                                    Free Fire
                                </a>
                            </li>


                            <li class="nav-item">
                                <a class="nav-link nav-pill require-login"
                                   th:href="@{/home/pendingOrders}"
                                   th:data-logged="${#authorization.expression('isAuthenticated()')}">
                                    <i class="fa fa-clock me-2"></i>Đơn hàng đang chờ
                                </a>
                            </li>

                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link nav-pill require-login"
                           th:href="@{/home/renting}"
                           th:data-logged="${#authorization.expression('isAuthenticated()')}">
                            <i class="fa fa-user-circle me-2"></i>Tài khoản đang thuê
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link nav-pill require-login"
                           th:href="@{/home/transaction}"
                           th:data-logged="${#authorization.expression('isAuthenticated()')}">
                            <i class="fa fa-credit-card me-2"></i>Ví
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link nav-pill require-login"
                           th:href="@{/home/cart}"
                           th:data-logged="${#authorization.expression('isAuthenticated()')}">
                            <i class="fa fa-coins me-2"></i>Giỏ Hàng
                        </a>
                    </li>
                </ul>

                <ul class="navbar-nav ms-lg-3 align-items-center nav-user">
                    <li class="nav-item dropdown" sec:authorize="isAnonymous()">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown">
                            <img src="/img/guest.png" class="rounded-circle me-2" style="width:35px;">
                            <span class="fw-semibold">Khách</span>
                        </a>
                        <ul class="dropdown-menu dropdown-fix">
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Đăng nhập</a></li>
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Đăng ký</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown">
                            <img src="/img/customer.png" class="rounded-circle me-2" style="width:35px;">
                            <span class="fw-semibold" th:text="${#authentication.name}"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-fix">
                            <li>
                                <a class="dropdown-item"
                                   th:href="@{/home/profile/{id}(id=${currentUser != null ? currentUser.customerId : ''})}">
                                    Thông tin tài khoản
                                </a>
                            </li>
                            <li>
                                <form th:action="@{/logout}" method="post">
                                    <button class="dropdown-item" type="submit">Đăng xuất</button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <style>
            .game-nav{background:pink;border-top:2px solid #e6d8c8;height:86px;display:flex;align-items:center}
            .game-nav .container-fluid{display:flex;align-items:center}
            .nav-logo{height:180px;width:auto}
            .nav-center{gap:26px}
            .game-nav .navbar-nav .nav-link{color:#111!important;font-weight:500}
            .nav-pill{background:transparent;color:#000!important;border:1px solid transparent;transition:background .15s ease,box-shadow .15s ease,transform .15s ease}
            .nav-pill:hover{color:#f7931e!important;background:#F8F8FF;box-shadow:none!important;transform:none!important}
            .nav-pill:focus,.nav-pill:active{background:#f5e6d7!important;color:#000!important;box-shadow:none!important}
            .dropdown-soft{border-radius:14px;padding:6px}
            .nav-pill{border-radius:18px!important;padding:10px 18px!important}
            .nav-pill:hover{border-radius:18px!important;box-shadow:0 6px 18px rgba(0,0,0,.08)!important}
            .nav-pill:focus,.nav-pill:active{border-radius:18px!important;box-shadow:0 6px 18px rgba(0,0,0,.08)!important}
        </style>
    </nav>

    <div id="loginAlert" class="alert alert-warning text-center fw-semibold d-none" style="position:fixed;top:80px;left:50%;transform:translateX(-50%);z-index:9999;">
        ⚠️ Vui lòng đăng nhập để sử dụng chức năng này
    </div>

    <script>
        document.querySelectorAll('.require-login').forEach(link => {
            link.addEventListener('click', function (e) {
                const isLogged = this.dataset.logged === 'true';
                if (!isLogged) {
                    e.preventDefault();
                    showLoginAlert();
                }
            });
        });
        function showLoginAlert() {
            const alertBox = document.getElementById('loginAlert');
            alertBox.classList.remove('d-none');
            setTimeout(() => {
                alertBox.classList.add('d-none');
            }, 3000);
        }
    </script>

    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show d-flex align-items-center justify-content-center mx-3 mt-3 auto-hide-alert" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close ms-3" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show d-flex align-items-center justify-content-center mx-3 mt-3 auto-hide-alert" role="alert">
        <i class="bi bi-x-circle-fill me-2"></i>
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close ms-3" data-bs-dismiss="alert"></button>
    </div>

    <div class="page-header mt-3">
        <div class="container d-flex align-items-center justify-content-between flex-wrap gap-2">
            <div>
                <h3 class="mb-0 text-white">Đơn hàng đang chờ</h3>
                <small class="opacity-75">Chỉ hiển thị trạng thái WAIT / WAITRENT</small>
            </div>
            <div class="pill">
                <i class="fa fa-layer-group"></i>
                <span class="fw-semibold" th:text="${pendingOrders != null ? #maps.size(pendingOrders) : 0} + ' order(s)'"></span>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <div class="card card-soft">
            <div class="card-body">

                <div th:if="${pendingOrders == null || #maps.isEmpty(pendingOrders)}" class="text-center py-5 text-muted">
                    Chưa có đơn hàng nào đang chờ.
                </div>

                <div th:if="${pendingOrders != null && !#maps.isEmpty(pendingOrders)}">

                    <div th:each="entry : ${pendingOrders}" class="order-card mb-3">

                        <div class="order-header">

                            <div class="order-left">
                                <div class="group-title">Order</div>
                                <div class="mono fw-semibold" th:text="${entry.key != null ? entry.key.id : ''}"></div>

                                <span class="badge bg-warning text-dark badge-soft"
                                      th:if="${entry.key != null && entry.key.status != null && (entry.key.status == 'WAIT' || entry.key.status == 'WAITRENT')}"
                                      th:text="${entry.key.status}"></span>
                            </div>

                            <div class="order-right">
                                <div class="order-meta">
                                    <div class="meta-chip">
                                        <span class="label">Date</span>
                                        <span class="val" th:text="${entry.key != null && entry.key.createdDate != null ? #temporals.format(entry.key.createdDate,'dd/MM/yyyy HH:mm') : '—'}"></span>
                                    </div>
                                    <div class="meta-chip">
                                        <span class="label">Total</span>
                                        <span class="val" th:text="${entry.key != null && entry.key.totalPrice != null ? #numbers.formatDecimal(entry.key.totalPrice,0,'COMMA',0,'POINT') + ' đ' : '—'}"></span>
                                    </div>
                                </div>

                                <div th:if="${entry.key != null && entry.key.id != null}">
                                    <form th:action="@{/home/pendingOrders/cancel/{orderId}(orderId=${entry.key.id})}"
                                          method="post"
                                          onsubmit="return confirm('Bạn chắc chắn muốn hủy đơn này?');">
                                        <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill btn-cancel">
                                            <i class="fa fa-times"></i>Cancel
                                        </button>
                                    </form>
                                </div>
                            </div>


                        </div>

                        <div class="table-responsive">
                            <table class="table align-middle mb-0">
                                <thead class="table-light">
                                <tr>
                                    <th style="width:70px;">#</th>
                                    <th>Game</th>
                                    <th>Model</th>
                                    <th>Duration</th>
                                    <th>Price</th>
                                </tr>
                                </thead>

                                <tbody>
                                <tr th:if="${entry.value == null || #lists.isEmpty(entry.value)}">
                                    <td colspan="5" class="text-center py-3 text-muted">Không có chi tiết đơn.</td>
                                </tr>

                                <tr th:each="od, i : ${entry.value}">
                                    <td th:text="${i.index + 1}"></td>

                                    <td class="fw-semibold"
                                        th:text="${od.game != null ? od.game.gameName : 'N/A'}"></td>

                                    <td class="mono"
                                        th:text="${od.game != null ? od.game.gameId : 'N/A'}"></td>

                                    <td>
                                        <span th:switch="${od.duration}">
                                            <span th:case="0">Mua vĩnh viễn</span>
                                            <span th:case="1">Thuê 1 tháng</span>
                                            <span th:case="2">Thuê 2 tháng</span>
                                            <span th:case="3">Thuê 3 tháng</span>
                                            <span th:case="*" th:text="${od.duration != null ? ('Thuê ' + od.duration + ' tháng') : '—'}"></span>
                                        </span>
                                    </td>

                                    <td th:text="${od.price != null ? #numbers.formatDecimal(od.price,0,'COMMA',0,'POINT') + ' đ' : '—'}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>

                </div>

            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        setTimeout(() => {
            document.querySelectorAll(".auto-hide-alert").forEach(alert => {
                const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>

    </body>
    </html>
