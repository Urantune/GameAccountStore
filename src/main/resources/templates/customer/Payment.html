<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thanh Toán Đơn Hàng</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
</head>
<body>

<div class="payment-box container my-5">
    <div class="mx-auto" style="max-width: 450px;">
        <div class="p-4 bg-white shadow-lg rounded-4">
            <h2 class="mb-4 text-center fw-bold">Thanh toán đơn hàng</h2>
            <!-- Info game -->
            <div class="product-info card shadow-sm border-0 mb-4">
                <div class="card-body text-center">

                    <h4 class="fw-bold mb-3" th:text="${games.game.gameName}"></h4>

                    <img th:src="@{'/images/' + ${games.imageMain}}"
                         class="img-fluid rounded-3 shadow mb-3"
                         style="max-height: 240px; object-fit: cover;" />

                    <div class="d-flex justify-content-center gap-4 flex-wrap mt-3">

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Price</p>
                            <p class="text-danger fw-bold fs-5" id="price" th:text="${games.price}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Rank</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.rank}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Skins</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.getSkin()}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Level</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.lovel}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">VIP</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.items}"></p>
                        </div>

                    </div>

                </div>
            </div>
            <!-- Form -->
            <form th:action="@{/home/order/confirm/{id}(id=${games.id})}" method="post">
                <!-- Nút mở modal -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Gói thanh toán</label>
                    <div class="input-group">
                        <input type="text" id="selectedPackage" class="form-control" placeholder="Chưa chọn"
                               readonly>

                        <button type="button" class="btn btn-primary"
                                data-bs-toggle="modal" data-bs-target="#editCountryModal">
                            Chọn gói
                        </button>
                    </div>
                    <!-- Hidden input để gửi lên server -->
                    <input type="hidden" name="package" id="packageValue">
                </div>

                <!-- Modal chọn gói -->
                <div class="modal fade" id="editCountryModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content rounded-3 shadow-lg">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">Chọn gói mua</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <label class="form-label fw-bold">Gói thanh toán</label>
                                <select id="new" class="form-select">
                                    <option selected disabled>-- Chọn gói --</option>
                                    <option>1 Tháng</option>
                                    <option>2 Tháng (Giảm 10% theo giá gốc)</option>
                                    <option>3 Tháng (Giảm 15% theo giá gốc)</option>
                                    <option>Vĩnh Viễn</option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary w-100" id="saveCountryBtn"
                                        data-bs-dismiss="modal">
                                    Chọn
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Mã giảm giá (Voucher)</label>
                    <div class="input-group">
                        <input type="text" class="form-control" name="voucherCode" placeholder="Nhập mã giảm giá...">
                        <button type="button" class="btn btn-primary fw-bold">Áp dụng</button>
                    </div>
                </div>
                <h4 class="mb-3 fw-bold text-center">Thông Tin Thanh Toán</h4>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Phương thức thanh toán</label>
                    <input class="form-control" value="Ví GamePay" readonly>
                    <input type="hidden" name="paymentMethod" value="MOMO">
                </div>
                <!-- Hiển thị Total Price -->
                <div id="totalPriceBox" class="mt-3 p-3 bg-light border rounded d-none">
                    <h5 class="fw-bold">Total Price:
                        <span id="totalPrice" class="text-danger"></span>
                    </h5>
                </div>
                <button type="submit" class="btn btn-danger w-100 py-2 fw-bold">
                    Xác Nhận Thanh Toán
                </button>
            </form>

        </div>
    </div>
</div>

<style>
    .payment-box {
        padding-bottom: 50px;
    }

    .product-info img {
        border-radius: 12px;
    }

</style>

<script>
    document.getElementById("saveCountryBtn").addEventListener("click", function () {
        let selected = document.getElementById("new").value;

        document.getElementById("selectedPackage").value = selected;
        document.getElementById("packageValue").value = selected;

        let basePriceText = document.getElementById("price").innerText.trim();
        let basePrice = parseFloat(basePriceText);
        let finalPrice = basePrice;

        if (selected.includes("1 Tháng")) {
            finalPrice = basePrice;
        } else if (selected.includes("2 Tháng")) {
            finalPrice = basePrice * 0.90;
        } else if (selected.includes("3 Tháng")) {
            finalPrice = basePrice * 0.85;
        } else if (selected.includes("Vĩnh Viễn")) {
            finalPrice = basePrice;
        }

        document.getElementById("totalPrice").innerText = finalPrice.toLocaleString() + " đ";

        document.getElementById("totalPriceBox").classList.remove("d-none");
    });
</script>



<script>
    document.getElementById("saveCountryBtn").addEventListener("click", function () {
        const value = document.getElementById("new").value;

        // Hiển thị gói đã chọn lên form
        document.getElementById("selectedPackage").value = value;

        // Gửi vào hidden input để server nhận được
        document.getElementById("packageValue").value = value;
    });
</script>
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js}"></script>

</body>
</html>
