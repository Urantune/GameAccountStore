<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thanh To√°n ƒê∆°n H√†ng</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
</head>
<body>

<div class="payment-box container my-5">
    <div class="mx-auto" style="max-width: 450px;">
        <div class="p-4 bg-white shadow-lg rounded-4">
            <h2 class="mb-4 text-center fw-bold">Thanh to√°n ƒë∆°n h√†ng</h2>
            <!-- Info game -->
            <div class="product-info card shadow-sm border-0 mb-4">
                <div class="card-body text-center">

                    <h4 class="fw-bold mb-3" th:text="${games.game.gameName}"></h4>

                    <img th:src="@{'/images/' + ${games.imageMain}}"
                         class="img-fluid rounded-3 shadow mb-3"
                         style="max-height: 240px; object-fit: cover;" />

                    <div class="d-flex justify-content-center gap-4 flex-wrap mt-3">

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Price</p>
                            <p class="text-danger fw-bold fs-5" id="price" th:text="${games.price}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Rank</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.rank}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Skins</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.getSkin()}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">Level</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.lovel}"></p>
                        </div>

                        <div class="info-item px-3 py-2 bg-light rounded">
                            <p class="mb-0 fw-semibold text-secondary">VIP</p>
                            <p class="text-danger fw-bold fs-5" th:text="${games.items}"></p>
                        </div>

                    </div>

                </div>
            </div>
            <!-- Form -->
            <form th:action="@{/home/order/confirm/{gameId}(gameId=${games.id})}" method="post">
                <!-- N√∫t m·ªü modal -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">G√≥i thanh to√°n</label>
                    <div class="input-group">
                        <input type="text" id="selectedPackage" class="form-control" placeholder="Ch∆∞a ch·ªçn"
                               readonly>

                        <button type="button" class="btn btn-primary"
                                data-bs-toggle="modal" data-bs-target="#editCountryModal">
                            Ch·ªçn g√≥i
                        </button>
                    </div>
                    <!-- Hidden input ƒë·ªÉ g·ª≠i l√™n server -->
                    <input type="hidden" name="package" id="packageValue">
                </div>

                <!-- Modal ch·ªçn g√≥i -->
                <div class="modal fade" id="editCountryModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content rounded-3 shadow-lg">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">Ch·ªçn g√≥i mua</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <label class="form-label fw-bold">G√≥i thanh to√°n</label>
                                <select id="new" class="form-select">
                                    <option selected disabled>-- Ch·ªçn g√≥i --</option>
                                    <option>1 Th√°ng</option>
                                    <option>2 Th√°ng (Gi·∫£m 10% theo gi√° g·ªëc)</option>
                                    <option>3 Th√°ng (Gi·∫£m 15% theo gi√° g·ªëc)</option>
                                    <option>Vƒ©nh Vi·ªÖn</option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary w-100" id="saveCountryBtn"
                                        data-bs-dismiss="modal">
                                    Ch·ªçn
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">M√£ gi·∫£m gi√° (Voucher)</label>
                    <div class="input-group">
                        <input type="text" class="form-control" name="voucherCode" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°...">
                        <button type="button" class="btn btn-primary fw-bold">√Åp d·ª•ng</button>
                    </div>
                </div>
                <h4 class="mb-3 fw-bold text-center">Th√¥ng Tin Thanh To√°n</h4>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Ph∆∞∆°ng th·ª©c thanh to√°n</label>
                    <input class="form-control" value="V√≠ GamePay" readonly>
                    <input type="hidden" name="paymentMethod" value="MOMO">
                </div>
                <!-- Hi·ªÉn th·ªã Total Price -->
                <div id="totalPriceBox" class="mt-3 p-3 bg-light border rounded d-none">
                    <h5 class="fw-bold">
                        Total Price:
                        <span id="totalPrice"
                              class="text-danger"
                              th:data-base-price="${games.price}"
                              th:text="${#numbers.formatDecimal(games.price, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">
        </span>
                    </h5>
                    <!-- g·ª≠i backend -->
                    <input type="hidden" name="totalPrice" id="totalPriceInput">
                    <input type="hidden" name="packageValues" id="packageValues">

                </div>

                <button type="submit" class="btn btn-danger w-100 py-2 fw-bold">
                    X√°c Nh·∫≠n Thanh To√°n
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    .payment-box {
        padding-bottom: 50px;
    }

    .product-info img {
        border-radius: 12px;
    }

</style>

<script>
    document.getElementById("saveCountryBtn").addEventListener("click", function () {

        const selected = document.getElementById("new").value;
        document.getElementById("packageValues").value = selected;

        // üî• l·∫•y gi√° g·ªëc chu·∫©n
        const basePrice = Number(
            document.getElementById("totalPrice").dataset.basePrice
        );

        let finalPrice = basePrice;

        if (selected.includes("2 Th√°ng")) {
            finalPrice = basePrice * 0.9;
        } else if (selected.includes("3 Th√°ng")) {
            finalPrice = basePrice * 0.85;
        }

        // l√†m tr√≤n VNƒê
        finalPrice = Math.round(finalPrice);

        // hi·ªÉn th·ªã
        document.getElementById("totalPrice").innerText =
            finalPrice.toLocaleString("vi-VN") + " ƒë";

        // g·ª≠i backend
        document.getElementById("totalPriceInput").value = finalPrice;

        document.getElementById("totalPriceBox").classList.remove("d-none");
    });
</script>




<script>
    document.getElementById("saveCountryBtn").addEventListener("click", function () {
        const value = document.getElementById("new").value;

        // Hi·ªÉn th·ªã g√≥i ƒë√£ ch·ªçn l√™n form
        document.getElementById("selectedPackage").value = value;

        // G·ª≠i v√†o hidden input ƒë·ªÉ server nh·∫≠n ƒë∆∞·ª£c
        document.getElementById("packageValue").value = value;
    });
</script>
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js}"></script>

</body>
</html>
