<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Rent Order Detail</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body { background:#f5f7fa; font-family:"Roboto",sans-serif; }
        .sidebar{
            width:260px; min-height:100vh; background:#2a3f54; position:fixed; left:0; top:0;
            color:#ecf0f1;
        }
        .sidebar h5{ padding:20px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.1); }
        .sidebar a{ display:block; padding:14px 24px; color:#ecf0f1; text-decoration:none; transition:0.2s; }
        .sidebar a i{ width:22px; }
        .sidebar a:hover{ background:#1abb9c; }

        .content{ margin-left:260px; padding:30px; }

        .card-box{
            background:#fff; border-radius:14px; box-shadow:0 6px 15px rgba(0,0,0,0.10);
            padding:16px 18px; border-left:6px solid #ff7a2f;
        }
        .meta{ font-size:0.9rem; color:#666; }
        .value{ color:#222; word-break:break-word; }
        .mono{
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 12px;
        }
        .table thead th{ background:#f3f5f8; }
        .table td, .table th{ vertical-align: middle; }
        .pill{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:6px 10px;
            border-radius:999px;
            background:#f3f5f8;
            font-size:.9rem;
            font-weight:700;
            color:#495057;
        }
        .big-actions{
            margin-top:18px;
            display:flex;
            gap:14px;
            justify-content:flex-end;
        }
        .btn-big{
            padding:14px 22px;
            font-weight:800;
            border-radius:14px;
            min-width:180px;
        }
        .badge-status{ font-size:.85rem; }
    </style>
</head>

<body>

<div th:replace="fragments/staff-sidebar :: staffSidebar"></div>

<div class="content container">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h4 class="mb-1"><i class="bi bi-receipt me-2"></i>Rent Order Detail</h4>
            <div class="meta">
                Order ID:
                <span class="mono" th:text="${order != null ? order.id : orderId}"></span>
                <span class="ms-2">|</span>
                Customer:
                <b th:text="${order != null && order.customer != null ? order.customer.username : 'N/A'}"></b>
                <span class="ms-2">|</span>
                Status:
                <span class="badge badge-status"
                      th:classappend="${order != null && order.status == 'WAITRENT'} ? ' bg-warning text-dark' : ' bg-secondary' "
                      th:text="${order != null ? order.status : 'N/A'}"></span>
            </div>
        </div>

        <a th:href="@{/staffHome/rentApproveList}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Back
        </a>
    </div>

    <div class="d-flex justify-content-end mb-3" th:if="${order != null}">
        <div class="text-end">
            <div class="meta">Created</div>
            <div class="value"
                 th:text="${order.createdDate != null ? #temporals.format(order.createdDate,'yyyy-MM-dd HH:mm:ss') : 'N/A'}"></div>
        </div>
    </div>

    <div class="card-box">

        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead>
                <tr>
                    <th style="min-width:220px;">OrderDetail ID</th>
                    <th style="min-width:220px;">GameAccount</th>
                    <th style="min-width:180px;">Game</th>
                    <th style="min-width:160px;">Duration</th>
                    <th style="min-width:160px;">Price</th>
                </tr>
                </thead>

                <tbody>
                <tr th:if="${orderDetails == null || #lists.isEmpty(orderDetails)}">
                    <td colspan="5" class="text-center text-muted py-4">No details.</td>
                </tr>

                <tr th:each="od : ${orderDetails}">
                    <td class="mono">
                        <div class="value" th:text="${od.id}"></div>
                    </td>

                    <td>
                        <div class="value mono"
                             th:text="${od.gameAccount != null ? od.gameAccount.gameAccountId : 'N/A'}"></div>
                        <div class="meta"
                             th:text="${od.gameAccount != null ? od.gameAccount.gameAccount : ''}"></div>
                    </td>

                    <td>
                        <span class="value"
                              th:text="${(od.game != null) ? od.game.gameName : (od.gameAccount != null && od.gameAccount.game != null ? od.gameAccount.game.gameName : 'N/A')}"></span>
                    </td>

                    <td>
                        <span class="pill">
                            <i class="bi bi-clock-history"></i>
                            <span th:text="${od.duration != null ? od.duration : 0}"></span> month(s)
                        </span>
                    </td>

                    <td>
                        <span class="value"
                              th:text="${od.price != null ? (#numbers.formatDecimal(od.price,0,'COMMA',0,'POINT') + ' Ä‘') : 'N/A'}"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <form id="decisionForm" method="post" th:action="@{/staffHome/rentApprove/decision}" class="mt-3">
            <input type="hidden" name="orderId" th:value="${order != null ? order.id : ''}">
            <input type="hidden" name="decision" id="decisionInput" value="">

            <input type="hidden" th:if="${_csrf != null}"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}">

            <div class="big-actions">
                <button type="button" class="btn btn-success btn-big" id="btnAccept">
                    <i class="bi bi-check2-circle me-2"></i>ACCEPT
                </button>
                <button type="button" class="btn btn-danger btn-big" id="btnReject">
                    <i class="bi bi-x-circle me-2"></i>REJECT
                </button>
            </div>
        </form>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById('btnAccept')?.addEventListener('click', () => {
        const decisionInput = document.getElementById('decisionInput');
        const form = document.getElementById('decisionForm');
        if (decisionInput) decisionInput.value = 'ACCEPT';
        if (form) form.submit();
    });

    document.getElementById('btnReject')?.addEventListener('click', () => {
        const decisionInput = document.getElementById('decisionInput');
        const form = document.getElementById('decisionForm');
        if (decisionInput) decisionInput.value = 'REJECT';
        if (form) form.submit();
    });
</script>

</body>
</html>
