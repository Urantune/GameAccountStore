<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manage Staff</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body{background:#f5f7fa;font-family:"Roboto",sans-serif}
        .sidebar{width:260px;min-height:100vh;background:#2a3f54;position:fixed;left:0;top:0;color:#ecf0f1}
        .sidebar h5{padding:20px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.1)}
        .sidebar a{display:block;padding:14px 24px;color:#ecf0f1;text-decoration:none}
        .sidebar a i{width:22px}
        .sidebar a:hover,.sidebar a.active{background:#1abb9c}
        .topbar{margin-left:260px;height:60px;background:#fff;border-bottom:1px solid #e0e0e0;display:flex;align-items:center;justify-content:space-between;padding:0 25px}
        .content{margin-left:260px;padding:30px}
        .table thead{background-color:#eef3f7}
        th.sortable{cursor:pointer;user-select:none}
    </style>
</head>
<body>

<div th:replace="fragments/adminSidebar :: adminSidebar"></div>


<div class="topbar">
    <h6 class="mb-0">Staff List</h6>
    <a th:href="@{/adminHome/staffCreate}" class="btn btn-sm btn-primary">
        <i class="bi bi-plus-circle me-1"></i>Add Staff
    </a>
</div>

<div class="content">
    <div class="bg-white rounded-3 shadow-sm p-3 mb-3">
        <form class="row g-2 align-items-center" th:action="@{/adminHome/staffList}" method="get">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text bg-light"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" name="q" placeholder="Search by username..." th:value="${q}">
                </div>
            </div>
            <div class="col-md-auto">
                <button class="btn btn-outline-secondary" type="submit">Search</button>
            </div>
            <div class="col-md-auto">
                <a class="btn btn-outline-secondary" th:href="@{/adminHome/staffList}">Clear</a>
            </div>
        </form>
    </div>

    <div class="table-responsive bg-white rounded-3 shadow-sm p-3">
        <table class="table table-hover align-middle mb-0" id="staffTable">
            <thead>
            <tr>
                <th>#</th>
                <th class="sortable">Username</th>
                <th class="sortable">Role</th>
                <th class="sortable">Status</th>
                <th class="sortable">Created</th>
                <th class="text-center">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="s, index : ${listStaff}">
                <td th:text="${index.index + 1}"></td>
                <td th:text="${s.username}"></td>
                <td th:text="${s.role}"></td>
                <td>
                    <span class="badge"
                          th:classappend="${s.status} == 'ACTIVE' ? ' bg-success' : ' bg-secondary'"
                          th:text="${s.status}"></span>
                </td>
                <td th:text="${s.created != null ? #temporals.format(s.created,'yyyy-MM-dd HH:mm:ss') : ''}"></td>
                <td class="text-center">
                    <a th:href="@{/adminHome/staffUpdate/{id}(id=${s.id})}" class="btn btn-sm btn-outline-warning">
                        <i class="bi bi-pencil-square"></i>
                    </a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(listStaff)}">
                <td colspan="6" class="text-center text-muted py-4">No staff found</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const table=document.getElementById("staffTable");
    const sortableHeaders=table.querySelectorAll("th.sortable");
    function getCellText(td){return td?(td.dataset.sort||td.textContent||"").trim():"";}
    sortableHeaders.forEach(header=>{
        if(!header.dataset.original) header.dataset.original=header.textContent.trim();
        header.addEventListener("click",()=>{
            const colIndex=Array.from(header.parentNode.children).indexOf(header);
            const rows=[...table.querySelectorAll("tbody tr")].filter(r=>r.children.length>1);
            const isAsc=header.classList.contains("asc");
            const direction=isAsc?-1:1;
            sortableHeaders.forEach(h=>{h.classList.remove("asc","desc");h.textContent=h.dataset.original;});
            header.classList.toggle("asc",direction===1);
            header.classList.toggle("desc",direction===-1);
            header.textContent=header.dataset.original+(direction===1?" ▲":" ▼");
            rows.sort((a,b)=>{
                const A=getCellText(a.children[colIndex]).toUpperCase();
                const B=getCellText(b.children[colIndex]).toUpperCase();
                return A.localeCompare(B,undefined,{sensitivity:"base"})*direction;
            });
            rows.forEach(r=>table.querySelector("tbody").appendChild(r));
        });
    });
</script>

</body>
</html>
